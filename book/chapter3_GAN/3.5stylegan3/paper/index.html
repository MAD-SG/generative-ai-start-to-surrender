
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../3.4stylegan2/paper/">
      
      
        <link rel="next" href="../../3.6styleganT/paper/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>StyleGAN3 - Generative AI: From Start to Surrender</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.a40c8224.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#stylegan3-overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Generative AI: From Start to Surrender" class="md-header__button md-logo" aria-label="Generative AI: From Start to Surrender" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Generative AI: From Start to Surrender
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              StyleGAN3
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../chapter1_Introduction/1.1terminology/" class="md-tabs__link">
          
  
  Introduction

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../chapter2_VAE/2.1introduction/" class="md-tabs__link">
          
  
  VAE

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../3.1from_gan_to_stylegan/paper/" class="md-tabs__link">
          
  
  GANs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../chapter4_diffusion/4.1introduction/" class="md-tabs__link">
          
  
  Diffusion

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../chapter5_generation_theory/5.1MLE/" class="md-tabs__link">
          
  
  Generation Theory

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../chapter6_ebm/introduction/" class="md-tabs__link">
          
  
  Energy Based Models

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Generative AI: From Start to Surrender" class="md-nav__button md-logo" aria-label="Generative AI: From Start to Surrender" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Generative AI: From Start to Surrender
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter1_Introduction/1.1terminology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter1_Introduction/1.2fourier_transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fourier Transform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter1_Introduction/1.3signal_processing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Signal Processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter1_Introduction/1.4statistics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Statistics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter1_Introduction/1.5SDE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SDE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter1_Introduction/tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    VAE
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            VAE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter2_VAE/2.1introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    GANs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            GANs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3.1from_gan_to_stylegan/paper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From GAN to PGGAN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3.3stylegan/paper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StyleGAN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3.4stylegan2/paper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StyleGAN2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    StyleGAN3
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    StyleGAN3
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terms" class="md-nav__link">
    <span class="md-ellipsis">
      Terms
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#abstract" class="md-nav__link">
    <span class="md-ellipsis">
      Abstract
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continuous-and-discrete-signals" class="md-nav__link">
    <span class="md-ellipsis">
      Continuous and Discrete Signals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-application" class="md-nav__link">
    <span class="md-ellipsis">
      Practical Application
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      代码解读
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3.6styleganT/paper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StyleGAN T
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3.7R3Gan/paper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R3GAN
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Diffusion
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Diffusion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter4_diffusion/4.1introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter4_diffusion/4.2DDPM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DDPM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Generation Theory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Generation Theory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter5_generation_theory/5.1MLE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maximal Likelihood
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter5_generation_theory/manifold_hypothesis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manifold Hypothesis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Energy Based Models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Energy Based Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter6_ebm/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter6_ebm/score_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Score Function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter6_ebm/sampling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sampling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter6_ebm/cd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contrastive Divergence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../chapter6_ebm/score_matching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Score Matching
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="stylegan3-overview">StyleGAN3 Overview<a class="headerlink" href="#stylegan3-overview" title="Permanent link">&para;</a></h1>
<h2 id="terms">Terms<a class="headerlink" href="#terms" title="Permanent link">&para;</a></h2>
<p>Aliasing（混叠） 是一个信号处理领域的基本问题，指的是当信号在采样过程中采样率不足时，高频信号的特性会被错误地映射到低频部分，从而导致失真或不正确的结果。这种现象同样适用于图像处理和深度学习中的生成网络。</p>
<p>在信号处理中的解释
定义：</p>
<p>在离散化连续信号时，如果采样率低于信号的奈奎斯特频率（Nyquist frequency，即信号最高频率的两倍），就会发生混叠。
混叠会导致高频信号被“折叠”到低频域，产生错误的频率信息。
示例：</p>
<p>在音频信号中，采样不足会导致原本的高音变成不相关的低音。
在图像处理中，缩小图像而没有正确低通滤波时会导致边缘或纹理出现波纹或锯齿状伪影。</p>
<h2 id="abstract">Abstract<a class="headerlink" href="#abstract" title="Permanent link">&para;</a></h2>
<p><strong>问题描述：</strong>
当前典型的 GAN 尽管具有层次化的卷积结构，但生成过程却依赖于绝对像素坐标，导致图像细节“粘在”像素网格上，而不是自然地附着在物体表面。</p>
<p><strong>问题根源：</strong>
这种现象的根本原因是生成器网络中的不当信号处理，特别是混叠问题（aliasing）。</p>
<p><strong>解决方法：</strong>
通过将网络中的所有信号视为连续信号，作者提出了一些普适的、较小的架构调整，以确保不必要的信息不会泄漏到层次化的生成过程中。</p>
<p><strong>改进效果：</strong>
新架构在图像质量指标（如 FID）上与 StyleGAN2 相当，但其内部表示发生了显著变化。
新模型在亚像素级别实现了对平移和旋转的等变性。</p>
<p><strong>应用前景：</strong>
这些改进为生成模型在视频和动画等动态任务中的应用奠定了基础，使生成效果更加自然和连贯。</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>引言部分明确了现有 GAN 中混叠问题的危害，分析了其原因，并提出了通过改进信号处理和生成器架构来解决这一问题的研究目标和贡献</p>
<h3 id="_1">问题背景<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>近年来，GAN 的图像生成质量有了显著提升（如 StyleGAN2 等），广泛应用于图像编辑、域迁移和视频生成等领域。
尽管生成器具有层次化的卷积结构，但生成过程对绝对像素坐标的依赖会导致 “纹理粘连”（texture sticking） 问题，即细节固定在像素坐标上而非自然附着在物体表面。</p>
<h3 id="_2">问题分析<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>纹理粘连现象：
生成细节（如纹理、毛发）在对象移动时未能正确随物体表面移动，破坏了视觉一致性，特别是在视频和动画生成中。
问题根源：
混叠是导致这一现象的核心原因。混叠源于不当的信号处理，如：
   - 不理想的上采样滤波器（如双线性插值）。
   - 激活函数（如 ReLU）带来的高频分量。
   - 网络边界填充（padding）等操作导致绝对像素坐标泄露。
   - 混叠的放大机制：
网络会主动利用这些混叠信息，通过多个尺度的结合放大它们，从而建立依赖绝对屏幕坐标的纹理模式。</p>
<h3 id="_3">论文目标<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>设计一个生成器架构，能够：
完全消除混叠问题，确保生成过程不依赖绝对像素坐标。
实现 平移和旋转等变性（translation and rotation equivariance），使生成的图像细节能够自然随物体变化。
保持与现有 GAN（如 StyleGAN2）相当的图像质量。</p>
<h3 id="_4">主要贡献<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>提出一种基于 连续信号解释（continuous signal interpretation） 的方法，重新设计 StyleGAN2 的生成器架构。
发现当前上采样滤波器在抑制混叠方面不够有效，需要更高质量的滤波器（如超过 100dB 的衰减能力）。
提出了一些普适的小型架构改动，既能有效抑制混叠，又能保证生成器的等变性。
新的生成器在图像质量指标（如 FID）上与 StyleGAN2 持平，但解决了纹理粘连问题，更适合用于视频和动画生成。</p>
<ul>
<li><strong>Texture sticking</strong> 问题举例说明
左侧（Central 和 Averaged）：
StyleGAN2：
现象：即使生成了一个图像的多个版本（通过对潜在空间的细微扰动），图像的细节（如猫的毛发或纹理）依然固定在绝对的像素坐标上。
结果：当对不同版本进行平均时，细节会呈现出非自然的锐化（sharpness），因为纹理没有随物体移动。
Ours（改进后的模型）：
现象：图像的细节不再固定于像素坐标，而是自然地跟随物体表面的变化。
结果：平均后的图像更平滑，符合预期。
右侧（Latent Interpolation）：
StyleGAN2：
现象：在潜在空间中进行插值生成时，(当生成内容进行水平的traslation时) 头发等细节没有跟随人脸的位置变化，而是像“粘在”固定的像素上，导致生成的动画中头发呈现水平条纹（streaks）。
Ours（改进后的模型）：
现象：头发的细节会随人物的位置自然移动，生成更连贯的动态效果。
结果：解决了纹理粘连问题，头发看起来更像真实物体的一部分。
视屏中更加明显。
<img alt="alt text" src="../../../../images/image-2.png" /></li>
</ul>
<iframe width="560" height="315"
        src="https://nvlabs-fi-cdn.nvidia.com/_web/stylegan3/videos/video_9_slice_visualization.mp4"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen>
</iframe>

<h2 id="continuous-and-discrete-signals">Continuous and Discrete Signals<a class="headerlink" href="#continuous-and-discrete-signals" title="Permanent link">&para;</a></h2>
<p>将网络中的特征图视为连续信号，而不是离散像素，从而严格遵循信号处理理论（如 Nyquist 定理）</p>
<h3 id="relationship-between-continuous-and-discrete-signals">Relationship Between Continuous and Discrete Signals<a class="headerlink" href="#relationship-between-continuous-and-discrete-signals" title="Permanent link">&para;</a></h3>
<p>假设连续信号为<span class="arithmatex">\(z(x)\)</span>,离散信号为<span class="arithmatex">\(Z(x)\)</span>, 采样频率为<span class="arithmatex">\(s\)</span>, 采样间隔则为<span class="arithmatex">\(T=\frac{1}{s}\)</span>.<span class="arithmatex">\(\cdot\)</span>表示乘积, 卷积表示<span class="arithmatex">\(\ast\)</span>.
二维狄拉克梳妆函数为<span class="arithmatex">\(III(x,y)=\sum_{m=-\infty}^{\infty}\sum_{n=-\infty}^{\infty}\delta(x-mT)\delta(y-nT)\)</span>
根据插值公式</p>
<div class="arithmatex">\[
Z(x,y)=z(x,y)\cdot\left(\text{III}(x,y)\right)\newline
= z(x,y)\cdot\left(\sum_{m=-\infty}^{\infty}\sum_{n=-\infty}^{\infty}\delta(x-mT)\delta(y-nT)\right)\newline
= \sum_{m=-\infty}^{\infty}\sum_{n=-\infty}^{\infty}z(mT,nT)\delta(x-mT)\delta(y-nT)\newline
\]</div>
<p>论文中对采样点向右进行了<span class="arithmatex">\(\frac{T}{2}\)</span>的偏移，这样的话</p>
<div class="arithmatex">\[Z(x,y) = \left(\sum_{m=-\infty}^{\infty}\sum_{n=-\infty}^{\infty}
z\left((m+\frac{1}{2})T,(n+\frac{1}{2})T\right)\delta(x-(m+\frac{1}{2})T)\delta(y-(n+\frac{1}{2})T)\right)\newline
\]</div>
<p>从离散信号恢复为连续信号， 根据插值公式</p>
<div class="arithmatex">\[
z(x,y) = \left(\sum_{m=-\infty}^{\infty}\sum_{n=-\infty}^{\infty}Z(mT,nT)\text{sinc}(\frac{x - mT}{T})\text{sinc}(\frac{y - nT}{T})\right)\newline
 = \left(\sum_{m=-\infty}^{\infty}\sum_{n=-\infty}^{\infty}Z(mT,nT)\alpha(x - mT,y - nT)\right)\newline
 = (Z\ast \alpha)(x,y)
\]</div>
<p>suppose<span class="arithmatex">\(\alpha(x，y) = \text{sinc}(\frac{x}{T})\text{sinc}(\frac{y}{T})\)</span></p>
<p>假设限定空间画布为[0,1]x[0,1]， 以<span class="arithmatex">\(s=\frac{1}{T}\)</span>频率进行采样时，偏移<span class="arithmatex">\(\frac{1}{2}T\)</span>采样会生成总共<span class="arithmatex">\(s^2\)</span>个采样点.
根据插值公式，如果要完全恢复原始信号，则需要[0,1]x[0,1] 之外的信号。
为什么呢？
<img alt="alt text" src="../../../../images/image-9.png" />
上面是sinc 函数的图形。对于x,y 这个位置, 恢复这一点的信息需要附近区域的采样值，且距离x,y 越远，对于恢复信息的贡献越小。
这就是为什么需要扩充采样空间的原因。在实际情况下，对于给定区域不需要扩充太大，因为sinc 呈现了一个随距离衰减的趋势。论文在实现的时候会先对特征图做一个扩充，也就是这个原理。</p>
<h3 id="equivariant-network-layers">Equivariant Network Layers<a class="headerlink" href="#equivariant-network-layers" title="Permanent link">&para;</a></h3>
<p>translation equivariance transformation</p>
<div class="arithmatex">\[f\cdot t = t\cdot f\]</div>
<p>假设输出的采样频率为<span class="arithmatex">\(s'\)</span>， 那么根据采样定理，需要满足<span class="arithmatex">\(f\)</span>作用之后的信号频率不操作<span class="arithmatex">\(s'/2\)</span>，也就<span class="arithmatex">\(f\)</span>不产生超过<span class="arithmatex">\(s'/2\)</span>的高频信号。</p>
<h4 id="convolution-layer">Convolution Layer<a class="headerlink" href="#convolution-layer" title="Permanent link">&para;</a></h4>
<h4 id="convolution">Convolution<a class="headerlink" href="#convolution" title="Permanent link">&para;</a></h4>
<p>Consider a standard convolution with a discrete kernel<span class="arithmatex">\(K\)</span>. We can interpret<span class="arithmatex">\(K\)</span>as living in the same grid as the input feature map, with sampling rate<span class="arithmatex">\(s\)</span>. The discrete-domain operation is simply:</p>
<div class="arithmatex">\[
\text{F}_{\text{conv}}(Z) = K \ast Z,
\]</div>
<p>and we obtain the corresponding continuous operation:</p>
<div class="arithmatex">\[
\text{f}_{\text{conv}}(z) = \varphi_s \ast \left( K \ast \left( \Pi_s \odot z \right) \right) = K \ast \left( \varphi_s \ast \left( \Pi_s \odot z \right) \right) = K \ast z
\]</div>
<p>这一步用到了卷积是可以交换的。</p>
<p>同时 根据卷积的频域等于频域的乘积</p>
<div class="arithmatex">\[
\text{F}_{\text{conv}}(K\ast Z)(e^{jw}) =\text{F}_{\text{conv}}(Z)(e^{jw}) \ast\text{F}_{\text{conv}}(K)(e^{jw})
\]</div>
<p>也就是对应频率的系数等于原始信号的频率乘以卷积的频率系数。
因此带宽只会变小，不会变大。
这就使得卷积操作天然满足采样定理的要求。</p>
<p>卷积对应的频域示意图
<img alt="alt text" src="../../../../images/image-10.png" /></p>
<h4 id="upsample-and-downsample">Upsample and Downsample<a class="headerlink" href="#upsample-and-downsample" title="Permanent link">&para;</a></h4>
<p><strong>上采样</strong>
上采样增加了信号的采样率。这里假设是理想上采样，也就是“插0” + 理想低通滤波
理想上采样后的信号频率会被压缩<span class="arithmatex">\(n\)</span>倍.<span class="arithmatex">\(n\)</span>是上采样的倍数。
经过理想上采样后，输出<span class="arithmatex">\(Y(e^{j\omega})\)</span>完全和原来的
<span class="arithmatex">\(X(e^{j\omega})\)</span>在频域中“缩放”后的主瓣部分相对应，也就是说，它在新的采样率下处于带宽<span class="arithmatex">\(\pi/n\)</span>的范围之内，且携带着原信号不失真的频谱信息。这就是“理想升采样”要达到的目的。</p>
<p><strong>下采样</strong></p>
<p>下采样频域公式离散形式</p>
<div class="arithmatex">\[y[m] = x[m\,M], \quad
Y(e^{j\Omega}) = \frac{1}{M}\sum_{k=0}^{M-1} X\!\Bigl(e^{\,j\,\tfrac{\Omega + 2\pi k}{M}}\Bigr).\]</div>
<p>连续形式</p>
<div class="arithmatex">\[
Y_{\mathrm{sample}}(\omega)
\;=\;
\frac{1}{M\,T}
\sum_{k=-\infty}^{\infty}
X\!\Bigl(\omega - 2\pi\,\tfrac{k}{M\,T}\Bigr).
\]</div>
<p>为了消除混叠现象，需要过滤掉高频信号(f/2以上的, f是原始信号频率)再进行下采样。</p>
<p>假设下采样倍数为<span class="arithmatex">\(s' = s/n\)</span>,<span class="arithmatex">\(s\)</span>为原始采样频率，那么</p>
<div class="arithmatex">\[
\begin{aligned}
F_{down} (Z)&amp; = \mathrm{III}_{s'} \odot \left[  \psi_{s'} \ast \left( \phi_{s} \ast Z \right) \right]\\
&amp; = \frac{1}{s^2} \mathrm{III}_{s'} \odot \left[  \psi_{s'} \ast \psi_{s} \ast Z \right]\\
&amp; = \frac{s'^2}{s^2} \mathrm{III}_{s'} \odot \left[  \phi_{s'} \ast Z \right]
\end{aligned}
\]</div>
<p>两个低通滤波的卷积任然是一个低通滤波.带宽为最小的带宽。
<span class="arithmatex">\(\left( \phi_{s} \ast Z \right)\)</span>是原始采样信号经过低通滤波，去除离散采用导致的高频信号。
因为需要下采样,需要额外移除高频信号，所以会作用另外一个<span class="arithmatex">\(\psi_{s'}\)</span>低通滤波。理想低通滤波器的系数只改变信号整体的强度，相当于归一下。先忽略掉系数的影响。
因为卷积具有交换律，可以先结合两个理想高通滤波器，从而得到最终的结果。
这个结果直观表示为 下采样之后的信号和原始信号按照最新的下采样频率进行采样时一致的，都满足采样定理，前提是原始信号需要满足带限性，并且带宽<span class="arithmatex">\(f&lt;\frac{1}{2}s'\)</span>。</p>
<p>下采样具有translation 不变性，即平移之后再下采样和下采样之后再平移得到的结果是一样的。
但是对于旋转并不保持不变性。如果要保持选择不变性，需要引入理想圆盘低筒滤波器， i.e., 2D Jinc filter</p>
<h4 id="2d-jinc-filter-frequency-spectrum">2D "Jinc" Filter Frequency Spectrum<a class="headerlink" href="#2d-jinc-filter-frequency-spectrum" title="Permanent link">&para;</a></h4>
<h5 id="spatial-domain-definition">Spatial Domain Definition<a class="headerlink" href="#spatial-domain-definition" title="Permanent link">&para;</a></h5>
<p>In the spatial domain, the 2D "Jinc" filter is:</p>
<div class="arithmatex">\[
h(x, y) = 2 \frac{J_1(2\pi r)}{r}, \quad r = \sqrt{x^2 + y^2}.
\]</div>
<p>at <span class="arithmatex">\(r = 0\)</span>,<span class="arithmatex">\(h(0, 0) = 1\)</span>.</p>
<h3 id="fourier-transform">Fourier Transform<a class="headerlink" href="#fourier-transform" title="Permanent link">&para;</a></h3>
<p>The frequency response is:</p>
<div class="arithmatex">\[
H(\rho) = 2\pi \int_0^\infty h(r) r J_0(2\pi \rho r) \, dr,
\]</div>
<p>where:
-<span class="arithmatex">\(\rho = \sqrt{u^2 + v^2}\)</span>,
-<span class="arithmatex">\(J_0\)</span>is the zero-order Bessel function.
Substitute<span class="arithmatex">\(h(r)\)</span>:</p>
<div class="arithmatex">\[
H(\rho) = 4\pi \int_0^\infty J_1(2\pi r) J_0(2\pi \rho r) \, dr.
\]</div>
<p>Using Bessel orthogonality:</p>
<div class="arithmatex">\[
H(\rho) =
\begin{cases}
1, &amp; \rho \leq 1, \\
0, &amp; \rho &gt; 1.
\end{cases}
\]</div>
<p>根据傅里叶变换理论，可知空间的旋转对应着频域的旋转，频域的旋转对应空间的旋转。即旋转等变性。
如果一个操作在空间上满足旋转不变性，就需要在频域上满足旋转不变性。频域上更容易理解。因此我们只要考虑频域就行。频域满足旋转不变性首先就需要频域是径向对称的，这也是为什么需要一个径向对称理想滤波器(2D Jinc filter)的原因。当然进一步严格实现选择不变性需要下采样是作用在极坐标空间下。</p>
<p><strong>非线性激活函数</strong>
pointwise操作天然满足 几何等变性。下面考虑带宽的条件。
<img alt="alt text" src="../../../../images/image-11.png" /></p>
<p>举一个具体的例子，例如<span class="arithmatex">\(x^2\)</span>,
- 原始信号
    设一个信号的傅里叶展开为：</p>
<p>$$
    x(t) = \sum_{k} a_k e^{j 2\pi f_k t},
   $$</p>
<pre><code>其中：
-$a_k$：信号的傅里叶系数。
-$f_k$：信号的频率分量。
</code></pre>
<ul>
<li>非线性操作后的频谱**
    假设对信号进行非线性操作<span class="arithmatex">\(f(x(t))\)</span>，如平方操作<span class="arithmatex">\(x^2(t)\)</span>，则结果为：</li>
</ul>
<p>$$
    f(x(t)) \sim \sum_{k,l} g(a_k, a_l) e^{j 2\pi (f_k + f_l)t},
   $$</p>
<pre><code>其中：
-$g(a_k, a_l)$：非线性操作产生的系数。
-$f_k + f_l$：新产生的频率分量。
</code></pre>
<p><strong>那要怎么实现非线性操作的带宽限制</strong></p>
<p>非线性操作后，结合理想低通滤波器<span class="arithmatex">\(\psi_s\)</span>，连续表示为：</p>
<div class="arithmatex">\[
f_\sigma(z) = \psi_s * \sigma(z),
\]</div>
<p>其中：
-<span class="arithmatex">\(\psi_s\)</span>是理想低通滤波器。
-<span class="arithmatex">\(\sigma(z)\)</span>是非线性操作后的信号。
-<span class="arithmatex">\(*\)</span>表示卷积。</p>
<h4 id="_5">离散形式<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>对应的离散版本表示为：</p>
<div class="arithmatex">\[
F_\sigma(Z) = s^2 \cdot \Pi_s \odot (\phi_s _\sigma(\phi_s_ Z)),
\]</div>
<p>其中：
-<span class="arithmatex">\(s^2\)</span>是比例因子。
-<span class="arithmatex">\(\Pi_s\)</span>表示降采样操作。
-<span class="arithmatex">\(\odot\)</span>表示逐点乘积（Hadamard乘积）。
-<span class="arithmatex">\(\phi_s\)</span>是插值滤波器。
-<span class="arithmatex">\(\sigma(\phi_s * Z)\)</span>表示在上采样后应用非线性操作。</p>
<p>其中<span class="arithmatex">\(\sigma(\phi_s * Z)\)</span>需要在连续空间中进行操作。为什么不能在离散空间中实现？</p>
<p>理想低通滤波器的无限支持：理想低通滤波器的频域是一个矩形函数，其时域响应是一个无限长的 sinc 函数。在离散域中，这种无限支持无法直接实现，只能通过截断近似，但这会引入其他误差（如振铃效应）。
非线性操作会引入高频分量，离散域中容易产生频谱混叠。</p>
<p>因此作者的想法是用上采样模拟连续空间，先上采样，再做非线性操作，再下采样。当然，要满足旋转不变性，则需要下采样应用 2D Jinc filter。</p>
<p>而且非线性操作也是网络中唯一生成额外高频信息的操作。可以控制她从而控制每一层需要的额外高频信息。高频信息即纹理信息。</p>
<h2 id="practical-application">Practical Application<a class="headerlink" href="#practical-application" title="Permanent link">&para;</a></h2>
<p>descriminator 不发生变化</p>
<p><strong>generator</strong>
<strong>目标</strong>： 设计等变性神经网络
用PSNR值衡量。值越高表示等变形越强。</p>
<h3 id="eq-t">EQ-T 公式<a class="headerlink" href="#eq-t" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
\text{EQ-T} = 10 \cdot \log_{10} \left( \frac{I_{\text{max}}^2}{\mathbb{E}_{\text{w} \sim \mathcal{W}, x \sim \mathcal{X}^2, p \sim \mathcal{V}, c \sim \mathcal{C}} \left[ \left( g(t_x[z_0]; \text{w})_c(p) - t_x[g(z_0; \text{w})]_c(p) \right)^2 \right]} \right)
\]</div>
<h4 id="_6">说明<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>-<span class="arithmatex">\(I_{\text{max}}\)</span>: 图像像素的最大可能值（如 255）。
-<span class="arithmatex">\(\mathbb{E}\)</span>: 表示期望值。
-<span class="arithmatex">\(\text{w} \sim \mathcal{W}\)</span>: 权重从分布<span class="arithmatex">\(\mathcal{W}\)</span>中采样。
-<span class="arithmatex">\(x \sim \mathcal{X}^2\)</span>: 输入从分布<span class="arithmatex">\(\mathcal{X}^2\)</span>中采样。
-<span class="arithmatex">\(p \sim \mathcal{V}\)</span>: 像素坐标从空间分布<span class="arithmatex">\(\mathcal{V}\)</span>中采样。
-<span class="arithmatex">\(c \sim \mathcal{C}\)</span>: 通道<span class="arithmatex">\(c\)</span>从通道分布<span class="arithmatex">\(\mathcal{C}\)</span>中采样。
-<span class="arithmatex">\(g(\cdot; \text{w})\)</span>: 表示图像操作或模型生成函数。
-<span class="arithmatex">\(t_x\)</span>: 几何变换（如平移、旋转、缩放等）。
-<span class="arithmatex">\(z_0\)</span>: 输入噪声或潜在变量。
从这个公式可以看到, 在旋转和平移是作用在 初始输入<span class="arithmatex">\(z_0\)</span>上的，而不是latent code<span class="arithmatex">\(w\)</span>.</p>
<h3 id="fourier">Fourier 特征<a class="headerlink" href="#fourier" title="Permanent link">&para;</a></h3>
<p>用 Fourier 特征替换 StyleGAN2 中的学习输入常数，便于精确连续变换输入，改善了 FID 并能计算等变性指标，但初始架构离等变性仍远。
SynthesisInput Forward 计算流程数学公式
输入定义和符号说明
假设：
-<span class="arithmatex">\(\text{w} \in \mathbb{R}^{B \times d}\)</span>：输入样式向量，来自潜在空间的映射网络。
-<span class="arithmatex">\(\text{f} \in \mathbb{R}^{C \times 2}\)</span>：可训练的频率向量。
-<span class="arithmatex">\(\text{p} \in \mathbb{R}^C\)</span>：可训练的相位向量。
-<span class="arithmatex">\(\text{A} \in \mathbb{R}^{C \times C}\)</span>：可训练的线性映射权重。
-<span class="arithmatex">\(\text{T} \in \mathbb{R}^{3 \times 3}\)</span>：用户定义的变换矩阵。
-<span class="arithmatex">\(H, W\)</span>：输出特征图的空间尺寸。
-<span class="arithmatex">\(\text{bandwidth}\)</span>和<span class="arithmatex">\(\text{sampling\_rate}\)</span>：频率范围和采样率。
初始化频率和相位
频率归一化
对于每个通道的频率向量<span class="arithmatex">\(\text{f}_i \in \mathbb{R}^2\)</span>，进行归一化：</p>
<div class="arithmatex">\[
\text{f}_i' = \frac{\text{f}_i}{\|\text{f}_i\|^2} \cdot \|\text{f}_i\|^{0.25} \cdot \text{bandwidth}, \quad \forall i \in [1, C]
\]</div>
<p>其中：
-<span class="arithmatex">\(\|\text{f}_i\|^2 = \text{f}_i \cdot \text{f}_i\)</span>是频率向量的平方范数。
随机初始化相位
相位<span class="arithmatex">\(\text{p}_i\)</span>初始化为均匀分布：</p>
<div class="arithmatex">\[
\text{p}_i \sim \text{Uniform}(-0.5, 0.5), \quad \forall i \in [1, C]
\]</div>
<p>样式向量到变换参数
从样式向量<span class="arithmatex">\(\text{w}\)</span>映射到变换参数<span class="arithmatex">\(\text{t}\)</span>：</p>
<div class="arithmatex">\[
\text{t} = \text{Affine}(\text{w}), \quad \text{t} = [r_c, r_s, t_x, t_y] \in \mathbb{R}^{B \times 4}
\]</div>
<p>归一化旋转参数
对旋转参数进行归一化：</p>
<div class="arithmatex">\[
r_c' = \frac{r_c}{\sqrt{r_c^2 + r_s^2}}, \quad r_s' = \frac{r_s}{\sqrt{r_c^2 + r_s^2}}
\]</div>
<p>构造变换矩阵
构造旋转矩阵和平移矩阵：</p>
<div class="arithmatex">\[
\text{M}_r=\begin{bmatrix}
r_c'&amp;-r_s'&0;\\
r_s'&amp;r_c'&0;\\
0&amp;0&1;
\end{bmatrix},
\text{M}_t=\begin{bmatrix}
1&amp;0&amp;-t_x;\\
0&amp;1&amp;-t_y;\\
0&amp;0&1;\end{bmatrix}\]</div>
<p>用户定义的变换矩阵<span class="arithmatex">\(T_\text{user}\)</span>和上述矩阵组合得到最终的变换矩阵：</p>
<div class="arithmatex">\[
T = M_r M_t T_\text{user}
\]</div>
<p>频率和相位的变换
将变换矩阵应用于频率和相位：</p>
<h3 id="31">3.1 频率变换<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
\text{f}_i'' = \text{f}_i' \cdot \text{T}_{1:2, 1:2}, \quad \forall i \in [1, C]
\]</div>
<p>相位变换</p>
<div class="arithmatex">\[
\text{p}_i'' = \text{p}_i + \text{f}_i' \cdot \text{T}_{1:2, 2:3}, \quad \forall i \in [1, C]
\]</div>
<p>频率幅值调整
为了抑制超出频率范围的分量，调整幅值：</p>
<div class="arithmatex">\[
\text{a}_i = \max\left(0, 1 - \frac{\|\text{f}_i''\| - \text{bandwidth}}{\frac{\text{sampling\_rate}}{2} - \text{bandwidth}}\right), \quad \forall i \in [1, C]
\]</div>
<p>构造傅里叶特征
采样网格
定义采样网格<span class="arithmatex">\(\text{G} \in \mathbb{R}^{H \times W \times 2}\)</span>：</p>
<div class="arithmatex">\[
\text{G}[h, w] = \left(\frac{w}{W} - 0.5, \frac{h}{H} - 0.5\right), \quad \forall h \in [0, H], w \in [0, W]
\]</div>
<p>傅里叶特征计算
通过频率和相位生成傅里叶特征：</p>
<div class="arithmatex">\[
\text{x}_\text{fourier}[b, h, w, c] = \sin\left(2 \pi (\text{G}[h, w] \cdot \text{f}_c'' + \text{p}_c'')\right) \cdot \text{a}_c
\]</div>
<p>应用线性映射
使用可训练的线性权重<span class="arithmatex">\(\text{A}\)</span>对傅里叶特征进行通道映射：</p>
<div class="arithmatex">\[
\text{x}_\text{out}[b, c, h, w] = \sum_{c'=1}^C \text{x}_\text{fourier}[b, h, w, c'] \cdot \frac{\text{A}_{c, c'}}{\sqrt{C}}
\]</div>
<p>最终公式总结
完整的 <code>SynthesisInput</code> forward 计算流程：</p>
<div class="arithmatex">\[
\text{x}_\text{out}[b, c, h, w] = \sum_{c'=1}^C \left[ \sin\left(2 \pi (\text{G}[h, w] \cdot \text{f}_{c'}'' + \text{p}_{c'}'')\right) \cdot \text{a}_{c'} \right] \cdot \frac{\text{A}_{c, c'}}{\sqrt{C}}
\]</div>
<p>其中：
-<span class="arithmatex">\(\text{f}_c''\)</span>和<span class="arithmatex">\(\text{p}_c''\)</span>是经过样式变换后的频率和相位。
-<span class="arithmatex">\(\text{a}_c\)</span>是幅值调整因子。
-<span class="arithmatex">\(\text{A}\)</span>是通道映射的权重。
物理意义</p>
<ol>
<li>通过频率<span class="arithmatex">\(\text{f}\)</span>和相位<span class="arithmatex">\(\text{p}\)</span>生成傅里叶特征，构建空间位置和样式相关的初始特征。</li>
<li>线性映射<span class="arithmatex">\(\text{A}\)</span>学习不同频率和相位的组合关系，为生成器提供任务相关的特征。
平移不会改变信号的频率分量（振幅不变），但会引入与平移量成比例的相位偏移。
旋转会同时改变空间域和频域信号的方向，但频率的幅度不变</li>
</ol>
<h2 id="_7">代码解读<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<h3 id="modulated_conv2d">modulated_conv2d<a class="headerlink" href="#modulated_conv2d" title="Permanent link">&para;</a></h3>
<pre><code>def modulated_conv2d(
    x,                  # Input tensor: [batch_size, in_channels, in_height, in_width]
    w,                  # Weight tensor: [out_channels, in_channels, kernel_height, kernel_width]
    s,                  # Style tensor: [batch_size, in_channels]
    demodulate  = True, # Apply weight demodulation?
    padding     = 0,    # Padding: int or [padH, padW]
    input_gain  = None, # Optional scale factors for the input channels: [], [in_channels], or [batch_size, in_channels]
):
    with misc.suppress_tracer_warnings(): # this value will be treated as a constant
        batch_size = int(x.shape[0])
    out_channels, in_channels, kh, kw = w.shape
    misc.assert_shape(w, [out_channels, in_channels, kh, kw]) # [OIkk]
    misc.assert_shape(x, [batch_size, in_channels, None, None]) # [NIHW]
    misc.assert_shape(s, [batch_size, in_channels]) # [NI]

    # Pre-normalize inputs.
    if demodulate:
        w = w * w.square().mean([1,2,3], keepdim=True).rsqrt()
        s = s * s.square().mean().rsqrt()

    # Modulate weights.
    w = w.unsqueeze(0) # [NOIkk] # 增加batch维度
    w = w * s.unsqueeze(1).unsqueeze(3).unsqueeze(4) # [NOIkk]

    # Demodulate weights.
    if demodulate:
        dcoefs = (w.square().sum(dim=[2,3,4]) + 1e-8).rsqrt() # [NO]
        w = w * dcoefs.unsqueeze(2).unsqueeze(3).unsqueeze(4) # [NOIkk]

    # Apply input scaling.
    if input_gain is not None:
        input_gain = input_gain.expand(batch_size, in_channels) # [NI]
        w = w * input_gain.unsqueeze(1).unsqueeze(3).unsqueeze(4) # [NOIkk]

    # Execute as one fused op using grouped convolution.
    x = x.reshape(1, -1, *x.shape[2:])
    w = w.reshape(-1, in_channels, kh, kw)
    x = conv2d_gradfix.conv2d(input=x, weight=w.to(x.dtype), padding=padding, groups=batch_size)
    x = x.reshape(batch_size, -1, *x.shape[2:])
    return x
</code></pre>
<h3 id="_8">最终数学表达式<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>经过以上步骤，最终输出 <span class="arithmatex">\( y \)</span> 的数学表达为：</p>
<div class="arithmatex">\[
y_{b,o,h',w'} = \sum_{i,k_h,k_w} \left[ x_{b,i,h+k_h,w+k_w} \cdot \left( w_{o,i,k_h,k_w} \cdot s_{b,i} \cdot d_{\text{coef},o} \cdot \text{input\_gain}_{b,i} \right) \right]
\]</div>
<p>其中：</p>
<ul>
<li>$ b $: 批量索引。</li>
<li>$ o, i $: 输出通道和输入通道索引。</li>
<li>$ h', w'$: 输出特征图的位置。</li>
<li>$ k_h, k_w $: 卷积核的空间维度索引。</li>
</ul>
<h3 id="_9">直观意义<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<ol>
<li>样式 $ s $ 动态地调节权重，调整每个卷积核的权重。同一个batch里不同的不同的样本style是独立的。体现了生成式模型中特征的个性化调整。</li>
<li>归一化和去归一化过程避免了数值不稳定性。权重归一化作用在i,k,h 维度上，也就是不同的卷积核上做normalize，具有相同的范数。对style 的归一化作用在所有的维度上。也就是整个s 归一化之后的范数为1.</li>
<li>分组卷积高效地实现了每个样本独立的权重调制计算。</li>
</ol>
<h3 id="synthesislayer">SynthesisLayer<a class="headerlink" href="#synthesislayer" title="Permanent link">&para;</a></h3>
<pre><code># Track input magnitude.
if update_emas:
    with torch.autograd.profiler.record_function('update_magnitude_ema'):
        magnitude_cur = x.detach().to(torch.float32).square().mean()
        self.magnitude_ema.copy_(magnitude_cur.lerp(self.magnitude_ema, self.magnitude_ema_beta))
input_gain = self.magnitude_ema.rsqrt()

# Execute affine layer.
styles = self.affine(w)
if self.is_torgb:
    weight_gain = 1 / np.sqrt(self.in_channels * (self.conv_kernel ** 2))
    styles = styles * weight_gain

# Execute modulated conv2d.
dtype = torch.float16 if (self.use_fp16 and not force_fp32 and x.device.type == 'cuda') else torch.float32
x = modulated_conv2d(x=x.to(dtype), w=self.weight, s=styles,
    padding=self.conv_kernel-1, demodulate=(not self.is_torgb), input_gain=input_gain)
</code></pre>
<h3 id="_10">数学公式<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>当前输入幅值的平方均值</strong>：</li>
</ol>
<p>$$
   \text{magnitude_cur} = \frac{1}{N} \sum_i x_i^2
   $$</p>
<p>其中：
   - <span class="arithmatex">\( x \)</span>: 输入特征。
   - <span class="arithmatex">\( N \)</span>: 输入特征中元素的总数。</p>
<ol>
<li><strong>EMA 更新</strong>：</li>
</ol>
<p>$$
   \text{magnitude_ema} = \beta \cdot \text{magnitude_ema} + (1 - \beta) \cdot \text{magnitude_cur}
   $$</p>
<p>其中：
   - $ \beta<span class="arithmatex">\(: EMA 的平滑系数 (\)</span> 0 &lt; \beta &lt; 1 $)。
   - $ \text{magnitude_cur} $: 当前输入幅值的平方均值。
   - $ \text{magnitude_ema} $: 历史平滑的输入幅值。</p>
<ol>
<li><strong>输入增益</strong>：</li>
</ol>
<p>$$
   \text{input_gain} = \frac{1}{\sqrt{\text{magnitude_ema}}}
   $$</p>
<hr />
<h3 id="_11">公式的直观意义<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>动态归一化</strong>：通过 <span class="arithmatex">\(\text{input\_gain}\)</span> 调整输入特征的幅值，确保其在训练过程中保持适当范围。</li>
<li><strong>平滑更新</strong>：EMA 提供了一种平滑的历史幅值估计，避免训练中的剧烈波动。</li>
<li><strong>数值稳定性</strong>：限制输入特征幅值的过大或过小，确保训练中的梯度稳定。
    input_gain 会作用在之后的卷积上，作用相当于对X做了一个归一化。可以称之为滑动平均归一化。目前所有的归一化都不改变mean。</li>
</ul>
<h3 id="filtered_lrelu">filtered_lrelu<a class="headerlink" href="#filtered_lrelu" title="Permanent link">&para;</a></h3>
<pre><code>x = filtered_lrelu.filtered_lrelu(x=x, fu=self.up_filter, fd=self.down_filter, b=self.bias.to(x.dtype),
            up=self.up_factor, down=self.down_factor, padding=self.padding, gain=gain, slope=slope, clamp=self.conv_clamp)
</code></pre>
<p><a href="https://github.com/NVlabs/stylegan3/blob/main/torch_utils/ops/filtered_lrelu.py">https://github.com/NVlabs/stylegan3/blob/main/torch_utils/ops/filtered_lrelu.py</a>
作者把上采样下采样和激活函数重新写了一个cuda kernel。太过于工程化，先跳过这部分。</p>
<h3 id="synthesislayerdesign_lowpass_filter">SynthesisLayer.design_lowpass_filter<a class="headerlink" href="#synthesislayerdesign_lowpass_filter" title="Permanent link">&para;</a></h3>
<pre><code>    @staticmethod
    def design_lowpass_filter(numtaps, cutoff, width, fs, radial=False):
        assert numtaps &gt;= 1

        # Identity filter.
        if numtaps == 1:
            return None

        # Separable Kaiser low-pass filter.
        if not radial:
            f = scipy.signal.firwin(numtaps=numtaps, cutoff=cutoff, width=width, fs=fs)
            return torch.as_tensor(f, dtype=torch.float32)

        # Radially symmetric jinc-based filter.
        x = (np.arange(numtaps) - (numtaps - 1) / 2) / fs
        r = np.hypot(*np.meshgrid(x, x))
        f = scipy.special.j1(2 * cutoff * (np.pi * r)) / (np.pi * r)
        beta = scipy.signal.kaiser_beta(scipy.signal.kaiser_atten(numtaps, width / (fs / 2)))
        w = np.kaiser(numtaps, beta)
        f *= np.outer(w, w)
        f /= np.sum(f)
        return torch.as_tensor(f, dtype=torch.float32)
</code></pre>
<h3 id="_12">滤波器的作用域与设计过程<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<h4 id="_13"><strong>作用域</strong><a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>这些滤波器 <strong>作用在时间域</strong>，它们通过时间域卷积操作处理输入信号或图像。卷积公式为：</p>
<div class="arithmatex">\[
y[n] = \sum_{k} x[k] \cdot h[n-k]
\]</div>
<p>其中：</p>
<ul>
<li><span class="arithmatex">\(x[k]\)</span>: 输入信号。</li>
<li><span class="arithmatex">\(h[k]\)</span>: 滤波器的时间域权重（脉冲响应）。</li>
<li><span class="arithmatex">\(y[n]\)</span>: 滤波后的输出信号。</li>
</ul>
<h4 id="_14"><strong>设计过程</strong><a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<p>尽管滤波器作用在时间域，其设计过程通常基于频域的要求，比如：</p>
<ul>
<li><strong>截止频率</strong> (<span class="arithmatex">\(\text{cutoff}\)</span>)：指定滤波器允许通过的频率范围。</li>
<li><strong>过渡带宽</strong> (<span class="arithmatex">\(\text{width}\)</span>)：控制滤波器从通带到阻带的过渡区域的宽度。</li>
<li><strong>频域形状</strong>：滤波器的设计目标是实现某种理想频率响应（如低通、高通或带通）。</li>
</ul>
<h4 id="_15"><strong>频域与时间域的关系</strong><a class="headerlink" href="#_15" title="Permanent link">&para;</a></h4>
<p>根据傅里叶变换理论，时间域与频域是一对互补的表示：</p>
<ul>
<li>滤波器的 <strong>时间域权重（脉冲响应）</strong> 决定其频域响应。</li>
<li>滤波器的 <strong>频域设计目标</strong>（如截止频率、过渡带宽）通过设计过程映射为时间域权重。</li>
</ul>
<h3 id="_16">代码中的滤波器设计<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Kaiser 滤波器</strong>：</li>
<li>使用 <code>scipy.signal.firwin</code> 基于频域要求生成时间域滤波器权重。</li>
<li>窗函数法通过调整 Kaiser 窗口的形状实现频率响应的优化。</li>
<li><strong>Jinc 滤波器</strong>：</li>
<li>基于径向对称的 Jinc 函数设计，其核心思想源自频域特性。</li>
<li>通过叠加 Kaiser 窗口进一步调整频域特性并生成时间域滤波器权重。</li>
</ol>
<h3 id="_17">总结<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>作用域</strong>：滤波器作用在时间域，使用卷积操作处理输入信号或图像。</li>
<li><strong>设计过程</strong>：基于频域要求（如截止频率、带宽）设计时间域滤波器权重。</li>
<li><strong>实际应用</strong>：在时间域中通过卷积实现对信号或图像频率成分的控制。</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "toc.integrate"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>